<html>
<head>
<title>UserContacts</title>
<link rel="stylesheet" type="text/css" href="/iface-profile/css/modal.css" >
</head>
<body>
	<table id="userTable" style="width:100%">
		  <tr>
		  	<th>ID</th>
		  	<th>Usuario</th>
		  	<th>Contato</th>
		  	<th>Tipo de contato</th>
		    <th>Opcoes</th> 
		  </tr>
	</table>
	
	<div id="modal" class="modal" style="width: 40%; margin-left: 30%">

	  <div class="modal-content">
	    <span class="close">x</span>
	    <h3 align="center" style="width: 100%"><b>Alterar dados do contato do usu�rio</b></h3>
	    <form id="myform" action="javascript:" onsubmit="submitForm()">
	    <table style="margin-left: 100px">
	    	
	    	<tr>
				<td>ID_Usuario:</td>
		 		<td><input id="userId" type="text" name="user">
		 		<input id="txtId" type="hidden"/></td>
		 	</tr>
		 	<tr>
				<td>Contato:</td>
		 		<td><input id="contactTxt" type="text" name="contact"></td>
		 	</tr>
		 	<tr>
				<td>ID_tipo de contato:</td>
		 		<td><input id="typeContactId" type="text" name="typeContact"></td>
		 	</tr>
		 	<tr>
				<td></td>
		 		<td align="right"><input type="submit" value="Atualizar"/></td>
		 	</tr>
	    </table>
	    </form>
	  </div>
	
	</div>
</body>
</html>


<script src="/iface-profile/js/jquery-3.1.0.min.js"></script>

<script>
$('#modal').hide();

$.ajax({
  type: "GET",
  headers:{
        "Content-Type":"application/json",
        "Accept":"application/json"
  },
  url: "/iface-profile/service/user_contact",
  success: function(data){
	  for(var i=0;i<data.length;i++){
	        var tr="<tr>";
	        var td1="<td align='center'>"+data[i]["id"]+"</td>";
	        var td2="<td align='center'>"+data[i]["user"]["name"]+"</td>";
	        var td3="<td align='center'>"+data[i]["contact"]+"</td>";
	        var td4="<td align='center'>"+data[i]["typeContact"]["name"]+"</td>";
	        var td5="<td align='center'>"
	        	+"<button onclick='abrirModal("+data[i]["id"]+")'>Editar</button>"
	        	+"<button onclick='excluirUsuario("+data[i]["id"]+")'>Excluir</button></td></tr>";

	       $("#userTable").append(tr+td1+td2+td3+td4+td5); 

	    }  
  }
});

function abrirModal(idUsed){
	$.ajax({
		  type: "GET",
		  url: "/iface-profile/service/user_contact/"+idUsed,
		  success: function(data){
			  $('#txtId').val(data["id"]);
	          $('#userId').val(data["user"]["id"]);
	          $('#contactTxt').val(data["contact"]);
	          $('#typeContactId').val(data["typeContact"]["id"]);
			 
			  $('#modal').show();
		  }
		});
}

window.onclick = function(event) {
    if (event.target == modal) {
    	$('#modal').hide();
    }
}

$(".close").click(function(){
	$('#modal').hide();
});



function formToJSON(){
    var json = '{"id": '+$("#txtId").val()+',"user":{"id":'+$("#userId").val()+'},"contact":"'+$("#contactTxt").val()+'","typeContact":{"id":'+$("#typeContactId").val()+'}}';
    return json;
}


function submitForm(){
	var formData = formToJSON();
	$.ajax({
		  type: "PUT",
		  headers:{
		        "Content-Type":"application/json",
		        "Accept":"application/json"
		  },
		  url: "/iface-profile/service/user_contact",
		  data: formData,
		  success: function(){
			  alert("Alterado com sucesso");
			  document.location = "/iface-profile/partials/list_usercontact.html";
		  },
		  dataType: "json",
		  contentType : "application/json"
		});
}

function excluirUsuario(idUsed){
	if(confirm("Deseja remover o contato do usu�rio de id "+idUsed+"?")){
		$.ajax({
			  type: "DELETE",
			  url: "/iface-profile/service/user_contact/"+idUsed,
			  success: function(){
				  alert("Excluido com sucesso");
				  document.location = "/iface-profile/partials/list_usercontact.html";
			  }
		});
	}
}




</script>