<html>
<head>
<title>Usuarios</title>
<link rel="stylesheet" type="text/css" href="/iface-profile/css/modal.css" >
</head>
<body>
	<table id="userTable" style="width:100%">
		  <tr>
		  	<th>Id</th>
		    <th>Nome</th>
		    <th>Username</th>
		    <th>Opcoes</th> 
		  </tr>
	</table>
	
	<div id="modal" class="modal" style="width: 40%; margin-left: 30%">

	  <div class="modal-content">
	    <span class="close">x</span>
	    <h3 align="center" style="width: 100%"><b>Alterar dados de usuario</b></h3>
	    <form id="myform" action="javascript:" onsubmit="submitForm()">
	    <table style="margin-left: 100px">
	    	
	    	<tr>
				<td>Nome:</td>
		 		<td><input id="txtNome" type="text" name="name">
		 		<input id="txtId" type="hidden"/></td>
		 	</tr>
		 	<tr>
				<td>Email:</td>
		 		<td><input id="txtEmail" type="text" name="email"></td>
		 	</tr>
		 	<tr>
				<td></td>
		 		<td align="right"><input type="submit" value="Atualizar"/></td>
		 	</tr>
	    </table>
	    </form>
	  </div>
	
	</div>
</body>
</html>


<script src="/iface-profile/js/jquery-3.1.0.min.js"></script>

<script>
$('#modal').hide();

$.ajax({
  type: "GET",
  headers:{
        "Content-Type":"application/json",
        "Accept":"application/json"
  },
  url: "/iface-profile/service/user",
  success: function(data){
	  for(var i=0;i<data.length;i++){
	        var tr="<tr>";
	        var td1="<td align='center'>"+data[i]["id"]+"</td>";
	        var td2="<td align='center'>"+data[i]["name"]+"</td>";
	        var td3="<td align='center'>"+data[i]["username"]+"</td>";
	        var td4="<td align='center'>"
	        	+"<button onclick='abrirModal("+data[i]["id"]+")'>Editar</button>"
	        	+"<button onclick='excluirUsuario("+data[i]["id"]+")'>Excluir</button></td></tr>";

	       $("#userTable").append(tr+td1+td2+td3+td4); 

	    }  
  }
});

function abrirModal(idUser){
	$.ajax({
		  type: "GET",
		  url: "/iface-profile/service/user/"+idUser,
		  success: function(data){
			  $('#txtId').val(data["id"]);
	          $('#txtNome').val(data["name"]);
	          $('#txtEmail').val(data["username"]);
			 
			  $('#modal').show();
		  }
		});
}

window.onclick = function(event) {
    if (event.target == modal) {
    	$('#modal').hide();
    }
}

$(".close").click(function(){
	$('#modal').hide();
});


function formToJSON(){
    var json = '{"id": '+$("#txtId").val()+',"name":"'+$("#txtNome").val()+'","username": "'+$("#txtEmail").val()+'"}';
    return json;
}


function submitForm(){
	var formData = formToJSON();
	$.ajax({
		  type: "PUT",
		  headers:{
		        "Content-Type":"application/json",
		        "Accept":"application/json"
		  },
		  url: "/iface-profile/service/user",
		  data: formData,
		  success: function(){
			  alert("Alterado com sucesso");
			  document.location = "/iface-profile/partials/list_users.html";
		  },
		  dataType: "json",
		  contentType : "application/json"
		});
}

function excluirUsuario(idUser){
	if(confirm("Deseja remover o usuario "+idUser+"?")){
		$.ajax({
			  type: "DELETE",
			  url: "/iface-profile/service/user/"+idUser,
			  success: function(){
				  alert("Excluido com sucesso");
				  document.location = "/iface-profile/partials/list_users.html";
			  }
		});
	}
}




</script>