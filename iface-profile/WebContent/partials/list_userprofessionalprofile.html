<html>
<head>
<title>UserProfessionalProfile</title>
<link rel="stylesheet" type="text/css" href="/iface-profile/css/modal.css" >
</head>
<body>
	<table id="userTable" style="width:100%">
		  <tr>
		  	<th>ID</th>
		  	<th>usuario</th>
		  	<th>Local de trabalho</th>
		  	<th>Cargo/Fun��o</th>
		  	<th>Data de admiss�o</th>
		  	<th>Data de dispensa</th>
		    <th>Opcoes</th> 
		  </tr>
	</table>
	
	<div id="modal" class="modal" style="width: 40%; margin-left: 30%">

	  <div class="modal-content">
	    <span class="close">x</span>
	    <h3 align="center" style="width: 100%"><b>Alterar dados do perfil acad�mico do usu�rio</b></h3>
	    <form id="myform" action="javascript:" onsubmit="submitForm()">
	    <table style="margin-left: 100px">
	    	
	    	<tr>
				<td>ID_usuario:</td>
		 		<td><input id="userTxt" type="text" name="user">
		 		<input id="txtId" type="hidden"/></td>
		 	</tr>
		 	<tr>
				<td>ID_local_de_trabalho:</td>
		 		<td><input id="linkTxt" type="text" name="link"></td>
		 	</tr>
		 	<tr>
				<td>Cargo/fun��o:</td>
		 		<td><input id="officeTxt" type="text" name="office"></td>
		 	</tr>
		 	<tr>
				<td>Data de admiss�o:</td>
		 		<td><input id="dateStartTxt" type="text" name="dateStart"></td>
		 	</tr>
		 	<tr>
				<td>Data de dispensa:</td>
		 		<td><input id="dateEndTxt" type="text" name="dateEnd"></td>
		 	</tr>
		 	<tr>
				<td></td>
		 		<td align="right"><input type="submit" value="Atualizar"/></td>
		 	</tr>
	    </table>
	    </form>
	  </div>
	
	</div>
</body>
</html>


<script src="/iface-profile/js/jquery-3.1.0.min.js"></script>

<script>
$('#modal').hide();

$.ajax({
  type: "GET",
  headers:{
        "Content-Type":"application/json",
        "Accept":"application/json"
  },
  url: "/iface-profile/service/user_professional_profile",
  success: function(data){
	  for(var i=0;i<data.length;i++){
	        var tr="<tr>";
	        var td1="<td align='center'>"+data[i]["id"]+"</td>";
	        var td2="<td align='center'>"+data[i]["user"]["name"]+"</td>";
	        var td3="<td align='center'>"+data[i]["link"]["name"]+"</td>";
	        var td4="<td align='center'>"+data[i]["office"]+"</td>";
	        var td5="<td align='center'>"+data[i]["dateStart"]+"</td>";
	        var td6="<td align='center'>"+data[i]["dateEnd"]+"</td>";
	        var td7="<td align='center'>"
	        	+"<button onclick='abrirModal("+data[i]["id"]+")'>Editar</button>"
	        	+"<button onclick='excluirUsuario("+data[i]["id"]+")'>Excluir</button></td></tr>";

	       $("#userTable").append(tr+td1+td2+td3+td4+td5+td6+td7); 

	    }  
  }
});

function abrirModal(idUsed){
	$.ajax({
		  type: "GET",
		  url: "/iface-profile/service/user_professional_profile/"+idUsed,
		  success: function(data){
			  $('#txtId').val(data["id"]);
	          $('#userTxt').val(data["user"]["id"]);
	          $('#linkTxt').val(data["link"]["id"]);
	          $('#officeTxt').val(data["office"]);
	          $('#dateStartTxt').val(data["dateStart"]);
	          $('#dateEndTxt').val(data["dateEnd"]);
			 
			  $('#modal').show();
		  }
		});
}

window.onclick = function(event) {
    if (event.target == modal) {
    	$('#modal').hide();
    }
}

$(".close").click(function(){
	$('#modal').hide();
});


function formToJSON(){
    var json = '{"id": '+$("#txtId").val()+',"user":{"id":'+$("#userTxt").val()+'},"link":{"id":'+$("#linkTxt").val()+'},"office":"'+$("#officeTxt").val()+'","dateStart":"'+$("#dateStartTxt").val()+'T00:00:00","dateEnd":"'+$("#dateEndTxt").val()+'T00:00:00"}';
    return json;
}


function submitForm(){
	var formData = formToJSON();
	$.ajax({
		  type: "PUT",
		  headers:{
		        "Content-Type":"application/json",
		        "Accept":"application/json"
		  },
		  url: "/iface-profile/service/user_professional_profile",
		  data: formData,
		  success: function(){
			  alert("Alterado com sucesso");
			  document.location = "/iface-profile/partials/list_userprofessionalprofile.html";
		  },
		  dataType: "json",
		  contentType : "application/json"
		});
}

function excluirUsuario(idUsed){
	if(confirm("Deseja remover o perfil profissional do usu�rio de id "+idUsed+"?")){
		$.ajax({
			  type: "DELETE",
			  url: "/iface-profile/service/user_professional_profile/"+idUsed,
			  success: function(){
				  alert("Excluido com sucesso");
				  document.location = "/iface-profile/partials/list_userprofessionalprofile.html";
			  }
		});
	}
}




</script>